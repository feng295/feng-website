<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>行動停車場管理資訊系統</title>
    <link rel="stylesheet" href="./styles.css">
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDx1m0ViIY5aCpF4Khxtuay2VZc6k3Ne0g&callback=initMap&loading=async&libraries=marker"></script>
</head>

<body>
    <div class="container" id="authContainer">
        <h2 id="formTitle">登入</h2>
        <form id="authForm">
            <div class="input-group">
                <label for="name">姓名</label>
                <input type="text" id="name" name="name" aria-required="true">
            </div>
            <div class="input-group">
                <label for="email">電子郵件</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="input-group">
                <label for="phone">電話號碼</label>
                <input type="text" id="phone" name="phone">
            </div>
            <div class="input-group">
                <label for="password">密碼</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div class="input-group">
                <label for="role">身份</label>
                <select id="role" name="role" required>
                    <option value="renter">租用者</option>
                </select>
            </div>
            <div id="renterFields" class="input-group" style="display: none;">
                <label for="license_plate">車牌號碼</label>
                <input type="text" id="license_plate" name="license_plate" placeholder="格式如: AAA-1111">
            </div>
            <div id="cardNumberContainer" class="input-group" style="display: none;">
                <label for="card_number">信用卡號</label>
                <input type="text" id="card_number" name="card_number" placeholder="請輸入信用卡號" required>
            </div>
            <button type="submit" id="submitButton">登入</button>
            <p id="toggleMessage">還沒有帳號？<a href="#" id="toggleLink">註冊</a></p>
            <p id="errorMessage"></p>
        </form>
    </div>

    <div id="parkingContainer" style="display: none;">
        <h1 id="pageTitle"></h1>
        <div class="system-container">
            <div class="function-list">
                <h1>功能清單</h1>
                <ul></ul>
            </div>
            <div class="content-container">
                <div id="addParking" class="content-section" style="display: none;">
                    <h2>新增停車場</h2>
                    <div class="input-group">
                        <label for="newLocation">地址：</label>
                        <input type="text" id="newLocation" placeholder="請輸入地址" maxlength="50" required
                            aria-label="車位地址">
                    </div>
                    <div class="input-group">
                        <label for="newParkingType">停車類型：</label>
                        <select id="newParkingType" required aria-label="選擇停車類型">
                            <option value="flat">平面</option>
                            <option value="mechanical">機械</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="newPriceLabel" for="newPrice">小時費用（元）：</label>
                        <input type="number" id="newPrice" step="0.01" value="40.00" min="0" required
                            aria-label="小時費用（元）">
                    </div>
                    <div class="input-group">
                        <label for="latitudeInput">經度：</label>
                        <input type="number" id="latitudeInput" step="0.000001" readonly aria-label="經度">
                    </div>
                    <div class="input-group">
                        <label for="longitudeInput">緯度：</label>
                        <input type="number" id="longitudeInput" step="0.000001" readonly aria-label="緯度">
                    </div>
                    <div class="input-group">
                        <label for="newTotalSpots">總停車位數量：</label>
                        <input type="number" id="newTotalSpots" placeholder="請輸入總停車位數量" value="1" min="1" required
                            aria-label="總停車位數量">
                    </div>
                    <div id="addParkingMap" style="height: 400px; width: 100%;"></div>
                    <div style="margin-top: 10px;">
                        <button id="saveNewSpotButton" aria-label="保存新車位">新增車位</button>
                        <button id="cancelAddButton" aria-label="取消新增車位">取消</button>
                    </div>
                </div>
                <div id="My parking space" class="content-section" style="display: none;">
                    <h2>車位列表</h2>
                    <table border="1" id="viewParkingTable">
                        <thead>
                            <tr>
                                <th>車位ID</th>
                                <th>地址</th>
                                <th>類型</th>
                                <th>小時費用（元）</th>
                                <th>車位狀況</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="My parking spaceTableBody">
                            <tr>
                                <td colspan="7">請選擇車位以查看詳情</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 在 <div id="rentParking" class="content-section"> 之前加入這個選單容器 -->
                <div id="parkingLotSelector" class="content-section" style="display: none;">
                    <h2 class="text-4xl font-bold text-center mb-8 text-blue-700">停車場進出場管理</h2>

                    <!-- 停車場選擇 -->
                    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
                        <label for="parkingLotSelect"
                            class="block text-2xl font-semibold mb-6 text-gray-800 text-center">
                            請選擇停車場
                        </label>
                        <select id="parkingLotSelect"
                            class="w-full p-5 text-xl border-4 border-gray-300 rounded-xl focus:border-blue-600 focus:outline-none">
                            <option value="">-- 請選擇停車場 --</option>
                        </select>
                    </div>

                    <!-- 動作選擇：進場 / 出場 -->
                    <div class="text-center my-10">
                        <div class="inline-flex rounded-xl shadow-2xl overflow-hidden">
                            <button id="actionEntry"
                                class="px-12 py-5 text-2xl font-bold bg-blue-600 text-white hover:bg-blue-700 transition">
                                進場
                            </button>
                            <button id="actionExit"
                                class="px-12 py-5 text-2xl font-bold bg-red-600 text-white hover:bg-red-700 transition">
                                出場結算
                            </button>
                        </div>
                    </div>

                    <!-- 車牌辨識區（預設隱藏） -->
                    <div id="recognitionContainer"
                        class="mt-10 mx-auto max-w-5xl bg-gray-50 rounded-2xl shadow-2xl p-10" style="display: none;">
                        <h3 class="text-4xl font-bold text-center mb-8 text-gray-800">
                            <span id="currentParkingName">載入中...</span> — <span id="currentAction">進場</span>
                        </h3>

                        <div class="flex justify-center mb-8">
                            <video id="videoRecognition" width="800" height="600" autoplay playsinline
                                class="border-8 border-black rounded-2xl shadow-2xl"></video>
                            <img id="fallbackImg" src="/static/no-camera.jpg"
                                style="display: none; width: 800px; height: 600px; border: 8px solid #000; border-radius: 16.px;"
                                alt="無攝影機">
                        </div>

                        <div class="text-center space-y-6">
                            <div class="text-7xl font-bold text-green-600 min-h-24" id="detectedPlate">
                                尚未檢測到車牌
                            </div>

                            <div id="loadingText" class="text-3xl text-blue-600 font-bold" style="display: none;">辨識中...
                            </div>
                            <div id="errorText" class="text-3xl text-red-600 font-bold" style="display: none;"></div>

                            <div class="space-x-6 mt-10">
                                <button id="startBtn"
                                    class="bg-green-600 hover:bg-green-700 text-white px-10 py-5 rounded-xl text-2xl font-bold shadow-lg">
                                    開始掃描
                                </button>
                                <button id="stopBtn" style="display: none;"
                                    class="bg-gray-600 hover:bg-gray-700 text-white px-8 py-4 rounded-xl text-xl">
                                    停止掃描
                                </button>
                                <button id="confirmBtn" disabled
                                    class="bg-blue-700 hover:bg-blue-800 text-white px-12 py-6 rounded-xl text-3xl font-bold shadow-2xl">
                                    確認進場
                                </button>
                                <button id="rescanBtn" style="display: none;"
                                    class="bg-orange-600 hover:bg-orange-700 text-white px-8 py-4 rounded-xl text-xl">
                                    重新掃描
                                </button>
                            </div>

                            <div id="settleResult" class="mt-12 text-6xl font-bold" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <div id="history" class="content-section" style="display: none;">
                    <h2>租用紀錄</h2>
                    <ul id="historyList"></ul>
                </div>
                <div id="incomeInquiry" class="content-section" style="display: none;">
                    <h2>收入查詢</h2>
                    <div class="search-container">
                        <label for="startDate">開始日期：</label>
                        <input type="date" id="startDate" required>
                        <label for="endDate">結束日期：</label>
                        <input type="date" id="endDate" required>
                        <button id="incomeSearchButton">查詢</button>
                    </div>
                    <div class="parking-spaces-table">
                        <table id="incomeTable">
                            <thead>
                                <tr>
                                    <th>車位 ID</th>
                                    <th>位置</th>
                                    <th>開始日期與時間</th>
                                    <th>結束日期與時間</th>
                                    <th>費用</th>
                                </tr>
                            </thead>
                            <tbody id="incomeTableBody">
                                <tr>
                                    <td colspan="5">請選擇日期以查看收入明細</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="totalIncomeDisplay" class="total-income">
                        <p>總收入：0 元</p>
                    </div>
                </div>
                <div id="viewAllUsers" class="content-section" style="display: none;">
                    <h2>查看所有用戶資料</h2>
                    <h3>租用者資料</h3>
                    <div class="parking-spaces-table">
                        <table id="renterTable">
                            <thead>
                                <tr>
                                    <th>用戶ID</th>
                                    <th>姓名</th>
                                    <th>電子郵件</th>
                                    <th>電話號碼</th>
                                    <th>車牌號碼</th>
                                </tr>
                            </thead>
                            <tbody id="renterTableBody">
                                <tr>
                                    <td colspan="6">請點擊搜尋以查看租用者資料</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="profile" class="content-section" style="display: none;">
                    <h2>個人資訊</h2>
                    <div id="profileData">
                        <p>載入中...</p>
                    </div>
                    <div id="editProfileForm" style="display: none;">
                        <h3>編輯個人資料</h3>
                        <div>
                            <label for="editName">姓名：</label>
                            <input type="text" id="editName" aria-required="true">
                        </div>
                        <div>
                            <label for="editPhone">電話：</label>
                            <input type="text" id="editPhone">
                        </div>
                        <div>
                            <label for="editEmail">電子郵件：</label>
                            <input type="email" id="editEmail" aria-required="true">
                        </div>
                        <div id="renterEditFields" style="display: none;">
                            <label for="editLicensePlate">車牌號碼：</label>
                            <input type="text" id="editLicensePlate">
                        </div>
                        <div>
                            <label for="editCardNumber">信用卡號：</label>
                            <input type="text" id="editCardNumber" required>
                        </div>
                        <button id="saveProfileButton">保存</button>
                        <button id="editProfileButton">編輯</button>
                        <button id="cancelEditProfileButton">取消</button>
                    </div>
                </div>
            </div>
        </div>
        <button id="logoutButton">登出</button>
    </div>

    <script src="./script.js"></script>
</body>

</html>